<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Smart Supply — Movimentações</title>
  <link rel="stylesheet" href="./assets/css/movimentacoes.css" />
  <link rel="icon" type="image/png" href="./assets/img/logo.png" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <style>
    /* ESTILOS DE EMERGÊNCIA - APLICAR DIRETAMENTE */
    body {
      font-family: 'Roboto', sans-serif !important;
      background: #152a4a !important;
      color: #000000 !important;
      margin: 0;
      padding: 0;
    }
    
    .card {
      background: white !important;
      padding: 2rem !important;
      border-radius: 12px !important;
      box-shadow: 0 8px 16px rgba(0,0,0,0.2) !important;
      margin: 1rem !important;
    }
    
    .card h2 {
      color: #1e3a5f !important;
      font-size: 1.5rem !important;
      margin-bottom: 1.5rem !important;
    }
    
    input, select {
      padding: 0.875rem 1rem !important;
      border: 2px solid #dee2e6 !important;
      border-radius: 8px !important;
      font-size: 1rem !important;
      width: 100% !important;
      margin-bottom: 1rem !important;
      background: white !important;
      color: #212529 !important;
    }
    
    button {
      padding: 0.875rem 1.5rem !important;
      border: none !important;
      border-radius: 8px !important;
      font-size: 1rem !important;
      background: #1e3a5f !important;
      color: white !important;
      cursor: pointer !important;
    }
    
    .table {
      width: 100% !important;
      border-collapse: collapse !important;
      background: white !important;
    }
    
    .table th {
      background: #1e3a5f !important;
      color: white !important;
      padding: 1rem !important;
    }
    
    .table td {
      padding: 1rem !important;
      border-bottom: 1px solid #dee2e6 !important;
    }
    
    footer {
      text-align: center !important;
      padding: 2rem !important;
      color: white !important;
      background: #152a4a !important;
    }
  </style>
</head>
<body>
  <!-- Seu conteúdo HTML aqui -->
<body>
  <div id="navbar"></div>
  <div class="container">
    <div class="grid cols-
      <section class="card">
        <h2>Nova Movimentação</h2>
        <form id="formMov" class="grid" style="gap:10px">
          <div class="form-row">
            <select id="m_produtoId" required>
              <option value="">Selecione um produto</option>
            </select>
            <select id="m_tipo" required>
              <option value="">Tipo</option>
              <option value="ENTRADA">ENTRADA</option>
              <option value="SAIDA">SAIDA</option>
            </select>
          </div>
          <div class="form-row">
            <input type="number" id="m_quantidade" placeholder="Quantidade" required />
            <input id="m_obs" placeholder="Observações (opcional)" />
          </div>
          <div class="actions">
            <button type="submit">Registrar</button>
            <button type="button" id="m_reset" class="secondary">Limpar</button>
          </div>
          <p id="m_msg" class="error"></p>
        </form>
      </section>

      <section class="card">
        <h2>Histórico</h2>
        <table class="table" id="tblMovs">
          <thead>
            <tr><th>ID</th><th>Data</th><th>Tipo</th><th>Qtd</th><th>Produto</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </section>
    </div>
  </div>

  <script type="module">
    import { requireAuth } from "./js/auth.js";
    import { http } from "./js/api.js";
    import { mountNavbar } from "./js/main.js";

    requireAuth(); mountNavbar("movs");

    const selProd = document.getElementById("m_produtoId");
    const tbody = document.querySelector("#tblMovs tbody");
    const form = document.getElementById("formMov");
    const msg = document.getElementById("m_msg");

    async function carregarProdutos() {
      const produtos = await http.get("/produtos");
      selProd.innerHTML = '<option value="">Selecione um produto</option>';
      produtos.forEach(p => {
        const opt = document.createElement("option");
        opt.value = p.id; opt.textContent = `${p.nome} • qtd: ${p.quantidade}`;
        selProd.appendChild(opt);
      });
    }

    function fmt(d) {
      const dt = new Date(d);
      return dt.toLocaleString();
    }

    async function carregarMovs() {
      const movs = await http.get("/movimentacoes");
      tbody.innerHTML = "";
      movs.forEach(m => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${m.id}</td>
          <td>${fmt(m.data)}</td>
          <td><span class="badge">${m.tipo}</span></td>
          <td>${m.quantidade}</td>
          <td>${m.produto?.nome || "-"}</td>`;
        tbody.appendChild(tr);
      });
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault(); msg.textContent = "";
      const body = {
        tipo: document.getElementById("m_tipo").value,
        quantidade: Number(document.getElementById("m_quantidade").value),
        produtoId: Number(selProd.value),
      };
      try {
        await http.post("/movimentacoes", body);
        form.reset();
        await carregarProdutos();
        await carregarMovs();
      } catch (err) { msg.textContent = err.message; }
    });

    document.getElementById("m_reset").addEventListener("click", () => form.reset());

    await carregarProdutos();
    await carregarMovs();
  </script>
    <!-- Rodapé adicionado -->
    <footer class="movimentacoes-footer">
      <p>Smart Supply © 2025 · Todos os direitos reservados</p>
    </footer>
</body>